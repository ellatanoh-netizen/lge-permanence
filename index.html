<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LGE - Droit et Justice | Permanence Op√©rationnelle</title>
    <style>
        /* ----- VARIABLES & RESET ----- */
        :root {
            --lge-green: #2e7d32;
            --lge-green-light: #e8f5e9;
            --lge-green-dark: #1b5e20;
            --amber: #d97706;
            --bg: #f8fafc;
            --text-primary: #0f172a;
            --text-secondary: #64748b;
            --white: #ffffff;
            --border: #e2e8f0;
            --radius-lg: 24px;
            --radius-md: 16px;
            --radius-sm: 12px;
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.05);
            --shadow-md: 0 4px 12px rgba(0,0,0,0.05);
            --shadow-lg: 0 20px 30px -10px rgba(0,0,0,0.1);
            --transition: all 0.2s ease;
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: var(--bg);
            color: var(--text-primary);
            line-height: 1.5;
            min-height: 100vh;
        }
        /* ----- UTILITAIRES ----- */
        .hidden { display: none !important; }
        .flex { display: flex; }
        .flex-col { flex-direction: column; }
        .items-center { align-items: center; }
        .justify-between { justify-content: space-between; }
        .gap-2 { gap: 0.5rem; }
        .gap-4 { gap: 1rem; }
        .p-4 { padding: 1rem; }
        .p-6 { padding: 1.5rem; }
        .p-8 { padding: 2rem; }
        .mt-4 { margin-top: 1rem; }
        .mb-4 { margin-bottom: 1rem; }
        .text-sm { font-size: 0.875rem; }
        .text-xs { font-size: 0.75rem; }
        .font-bold { font-weight: 700; }
        .font-semibold { font-weight: 600; }
        .text-muted { color: var(--text-secondary); }
        /* ----- COMPOSANTS ----- */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.75rem 1.5rem;
            border-radius: var(--radius-md);
            font-weight: 600;
            font-size: 0.95rem;
            border: none;
            cursor: pointer;
            transition: var(--transition);
            background-color: var(--white);
            color: var(--text-primary);
            border: 1px solid var(--border);
        }
        .btn-primary {
            background-color: var(--lge-green);
            color: white;
            border: none;
            box-shadow: 0 2px 8px rgba(46,125,50,0.2);
        }
        .btn-primary:hover {
            background-color: var(--lge-green-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(46,125,50,0.3);
        }
        .btn-outline {
            background: transparent;
            border: 1px solid var(--border);
        }
        .btn-outline:hover {
            background: #f1f5f9;
        }
        .card {
            background-color: var(--white);
            border-radius: var(--radius-md);
            border: 1px solid var(--border);
            padding: 1.5rem;
            box-shadow: var(--shadow-sm);
            transition: var(--transition);
        }
        .card:hover {
            box-shadow: var(--shadow-md);
        }
        .input, .select, textarea {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 1.5px solid var(--border);
            border-radius: var(--radius-sm);
            font-family: inherit;
            font-size: 0.95rem;
            transition: var(--transition);
            background-color: var(--white);
        }
        .input:focus, .select:focus, textarea:focus {
            outline: none;
            border-color: var(--lge-green);
            box-shadow: 0 0 0 3px rgba(46,125,50,0.1);
        }
        label {
            font-weight: 600;
            font-size: 0.9rem;
            display: block;
            margin-bottom: 0.4rem;
            color: var(--text-primary);
        }
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 1.5rem;
        }
        .section-title {
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            font-weight: 700;
            color: var(--lge-green);
            margin-bottom: 1.5rem;
            background: var(--lge-green-light);
            display: inline-block;
            padding: 0.3rem 1rem;
            border-radius: 20px;
        }
        /* ----- LAYOUT ----- */
        #login-screen {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 2rem;
            background: radial-gradient(circle at 10% 20%, #f0fdf4, #f8fafc);
        }
        .login-card {
            max-width: 480px;
            width: 100%;
            background: var(--white);
            border-radius: var(--radius-lg);
            overflow: hidden;
            box-shadow: var(--shadow-lg);
        }
        .login-header {
            background: var(--lge-green);
            color: white;
            padding: 3rem 2rem;
            text-align: center;
        }
        .login-body {
            padding: 2.5rem 2rem;
        }
        /* dashboard */
        .app-header {
            background: rgba(255,255,255,0.8);
            backdrop-filter: blur(12px);
            padding: 1rem 2rem;
            border-bottom: 2px solid var(--lge-green);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 50;
        }
        .container {
            max-width: 1280px;
            margin: 2rem auto;
            padding: 0 2rem;
        }
        .session-info {
            display: flex;
            align-items: center;
            gap: 1rem;
            flex-wrap: wrap;
            background: var(--white);
            padding: 1rem 1.5rem;
            border-radius: var(--radius-md);
            border: 1px solid var(--border);
            margin-bottom: 2rem;
            font-size: 0.9rem;
        }
        .badge {
            background: var(--lge-green-light);
            color: var(--lge-green-dark);
            padding: 0.25rem 0.75rem;
            border-radius: 50px;
            font-weight: 600;
            font-size: 0.8rem;
        }
        .action-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }
        .action-card {
            display: block;
            text-decoration: none;
            color: inherit;
            background: var(--white);
            border-radius: var(--radius-md);
            border: 1px solid var(--border);
            padding: 1.8rem 1.5rem;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }
        .action-card:hover {
            transform: translateY(-4px);
            border-color: var(--lge-green);
            box-shadow: var(--shadow-lg);
        }
        .action-card::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--border);
            transition: background 0.2s;
        }
        .action-card:hover::after {
            background: var(--lge-green);
        }
        .action-title {
            font-weight: 700;
            font-size: 1.25rem;
            margin-bottom: 0.5rem;
        }
        .action-desc {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }
        /* modales */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(15,23,42,0.3);
            backdrop-filter: blur(8px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 1.5rem;
        }
        .modal-container {
            background: var(--white);
            border-radius: var(--radius-lg);
            width: 100%;
            max-width: 1000px; /* plus large pour le rapport */
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
            animation: modalFadeIn 0.2s ease;
        }
        @keyframes modalFadeIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
        .modal-header {
            padding: 1.5rem 2rem;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            background: var(--white);
            z-index: 10;
        }
        .modal-header h2 {
            font-size: 1.5rem;
            font-weight: 700;
        }
        .close-btn {
            background: #f1f5f9;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            cursor: pointer;
            transition: var(--transition);
        }
        .close-btn:hover {
            background: #e2e8f0;
        }
        .modal-body {
            padding: 2rem;
        }
        .form-section {
            margin-bottom: 2.5rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid var(--border);
        }
        .form-section:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-weight: 500;
            cursor: pointer;
        }
        .checkbox-label input[type="checkbox"] {
            width: 1.2rem;
            height: 1.2rem;
            accent-color: var(--lge-green);
        }
        .btn-logout {
            width: 100%;
            padding: 1rem;
            background: #fff;
            color: #ef4444;
            border: 2px solid #fee2e2;
            border-radius: var(--radius-md);
            font-weight: 700;
            text-transform: uppercase;
            cursor: pointer;
            transition: var(--transition);
            margin: 3rem 0 1rem;
        }
        .btn-logout:hover {
            background: #fee2e2;
        }
        /* Styles pour le rapport juridique */
        .rapport-juridique {
            background: #f0f9ff;
            border-left: 4px solid var(--lge-green);
            padding: 1.5rem;
            border-radius: var(--radius-md);
            margin-top: 2rem;
            font-size: 0.95rem;
        }
        .rapport-juridique h4 {
            color: var(--lge-green-dark);
            margin: 1rem 0 0.5rem;
            font-size: 1rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .rapport-juridique p {
            margin: 0.5rem 0;
        }
        .rapport-juridique ul {
            margin: 0.5rem 0 1rem 1.5rem;
        }
        .rapport-juridique li {
            margin: 0.25rem 0;
        }
        .rapport-juridique .source {
            font-size: 0.85rem;
            color: var(--text-secondary);
            border-top: 1px solid var(--border);
            margin-top: 1rem;
            padding-top: 1rem;
        }
        .rapport-juridique a {
            color: var(--lge-green);
            text-decoration: none;
        }
        .rapport-juridique a:hover {
            text-decoration: underline;
        }
        /* Styles pour la section bien-√™tre */
        .bienetre-container {
            background: #fff3e0;
            border-radius: var(--radius-md);
            padding: 1.5rem;
            margin: 1rem 0;
        }
        .emojis-row {
            display: flex;
            gap: 1rem;
            justify-content: space-around;
            flex-wrap: wrap;
            margin: 1rem 0;
        }
        .emoji-option {
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: var(--radius-sm);
            transition: var(--transition);
            border: 2px solid transparent;
        }
        .emoji-option.selected {
            border-color: var(--lge-green);
            background: var(--lge-green-light);
        }
        .emoji-option span:first-child {
            font-size: 2rem;
        }
        .emoji-option span:last-child {
            font-size: 0.8rem;
            font-weight: 600;
        }
        .bienetre-reco {
            background: white;
            padding: 1rem;
            border-radius: var(--radius-sm);
            border-left: 4px solid var(--lge-green);
            margin-top: 1rem;
        }
        @media (max-width: 640px) {
            .container { padding: 0 1rem; }
            .app-header { padding: 1rem; }
            .modal-header { padding: 1rem 1.5rem; }
            .modal-body { padding: 1.5rem; }
            .form-grid { grid-template-columns: 1fr; }
            .modal-container { max-width: 100%; }
        }
    </style>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
</head>
<body>

    <!-- √âCRAN DE CONNEXION -->
    <div id="login-screen">
        <div class="login-card">
            <div class="login-header">
                <img src="https://lgedroitetjustice.fr/wp-content/uploads/2025/05/cropped-cropped-LOGO-2-282x300.png" height="90" alt="Logo LGE" style="filter: brightness(0) invert(1);">
                <h1 style="margin-top:1.5rem; font-weight:800; font-size:1.8rem;">LES GRAINES DE L'ESPOIR</h1>
                <p style="opacity:0.9; font-size:1rem;">Portail de Permanence</p>
            </div>
            <div class="login-body">
                <form id="login-form" onsubmit="demarrerPermanence(event)">
                    <div class="form-group">
                        <label>Email du b√©n√©vole</label>
                        <input type="email" id="email-input" class="input" placeholder="prenom.nom@lge.fr" required>
                    </div>
                    <div class="form-group">
                        <label>Type de permanence</label>
                        <select id="permanence-type" class="select" required>
                            <option value="classique">Permanence Classique</option>
                            <option value="mobile_juridique">Permanence Mobile Juridique</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width:100%; margin-top:1rem;">Lancer la session</button>
                </form>
            </div>
        </div>
    </div>

    <!-- DASHBOARD PRINCIPAL -->
    <div id="dashboard" class="hidden">
        <header class="app-header">
            <div class="flex items-center gap-4">
                <img src="https://lgedroitetjustice.fr/wp-content/uploads/2025/05/cropped-cropped-LOGO-2-282x300.png" height="40" alt="LGE">
                <span class="font-bold" style="font-size:1.2rem;">PERMANENCE OP√âRATIONNELLE</span>
            </div>
            <div id="live-clock" class="text-right">
                <div id="date-now" class="text-xs text-muted uppercase"></div>
                <div id="time-now" class="font-bold text-lge-green" style="font-size:1.2rem;"></div>
            </div>
        </header>

        <div class="container">
            <!-- Infos session -->
            <div class="session-info">
                <div class="flex items-center gap-2">
                    <span class="badge" id="user-display"></span>
                    <span class="text-sm text-muted">Connect√©(e)</span>
                </div>
                <div class="flex items-center gap-2">
                    <span>üïí D√©but :</span>
                    <span class="font-semibold" id="start-time-display"></span>
                </div>
                <div class="flex items-center gap-2">
                    <span>üìã Type :</span>
                    <span class="font-semibold" id="permanence-type-display"></span>
                </div>
            </div>

            <!-- DASHBOARD CLASSIQUE -->
            <div id="dashboard-classique" class="hidden">
                <div class="action-grid">
                    <div onclick="openFicheContact()" class="action-card" style="cursor:pointer;">
                        <div class="action-title">üìã Nouvelle fiche contact</div>
                        <div class="action-desc">Enregistrer une interaction (b√©n√©ficiaire, partenaire, etc.)</div>
                    </div>
                    <a href="https://docs.google.com/spreadsheets/d/1HHgQbhCWtAS_LD93yFf9JncpuvCoXVod112bTr5wYmo/edit?usp=sharing" target="_blank" class="action-card">
                        <div class="action-title">üìû Annuaire interne</div>
                        <div class="action-desc">Contacts p√¥les et partenaires</div>
                    </a>
                    <a href="https://forms.gle/efW4RKVZF3tnEFts8" target="_blank" class="action-card">
                        <div class="action-title">üìù Compte-rendu de vacation</div>
                        <div class="action-desc">Bilan de fin de permanence</div>
                    </a>
                    <a href="https://drive.google.com/file/d/1ECDdNKRRwPsh5LN5Jq9xRC-cx6rvpOXz/view" target="_blank" class="action-card">
                        <div class="action-title">‚öñÔ∏è Protocole op√©rationnel</div>
                        <div class="action-desc">Cadre et proc√©dures</div>
                    </a>
                    <a href="https://calendar.app.google/vmuAcu8KPvzkd5vC8" target="_blank" class="action-card">
                        <div class="action-title">üìÖ R√©server un cr√©neau</div>
                        <div class="action-desc">Maison des Associations</div>
                    </a>
                    <!-- Lien CARELINE WhatsApp -->
                    <a href="https://wa.me/33784812030" target="_blank" class="action-card" style="border-color: #25D366;">
                        <div class="action-title">üì± CARELINE WhatsApp</div>
                        <div class="action-desc">Contacter l'√©quipe soutien</div>
                    </a>
                </div>
            </div>

            <!-- DASHBOARD MOBILE JURIDIQUE -->
            <div id="dashboard-mobile" class="hidden">
                <div class="action-grid">
                    <div onclick="openFicheMobile()" class="action-card" style="cursor:pointer;">
                        <div class="action-title">‚öñÔ∏è Dossier mobile juridique</div>
                        <div class="action-desc">Nouvelle intervention itin√©rante (avec assistant)</div>
                    </div>
                    <a href="https://docs.google.com/spreadsheets/d/1HHgQbhCWtAS_LD93yFf9JncpuvCoXVod112bTr5wYmo/edit?usp=sharing" target="_blank" class="action-card">
                        <div class="action-title">üìû Annuaire juridique</div>
                        <div class="action-desc">Avocats, p√¥les, partenaires</div>
                    </a>
                    <a href="https://drive.google.com/file/d/1CiJANqE4y4xSXFPU842kEH-B6KxNVoL1/view" target="_blank" class="action-card">
                        <div class="action-title">‚öñÔ∏è Protocole mobile</div>
                        <div class="action-desc">Proc√©dure unit√© mobile</div>
                    </a>
                    <a href="https://drive.google.com/file/d/1FIsLRBXEMoAzB21MkjwstZ-WUueROhuD/view" target="_blank" class="action-card">
                        <div class="action-title">üó∫Ô∏è Guide mobiles</div>
                        <div class="action-desc">Gestion itin√©rante</div>
                    </a>
                    <a href="#" id="booking-mobile-link" target="_blank" class="action-card">
                        <div class="action-title">üìå R√©server un cr√©neau</div>
                        <div class="action-desc">Tourn√©e mobile</div>
                    </a>
                    <!-- Lien CARELINE WhatsApp aussi pour mobile -->
                    <a href="https://wa.me/33784812030" target="_blank" class="action-card" style="border-color: #25D366;">
                        <div class="action-title">üì± CARELINE WhatsApp</div>
                        <div class="action-desc">Contacter l'√©quipe soutien</div>
                    </a>
                </div>
            </div>

            <button class="btn-logout" onclick="confirmerDeconnexion()">Terminer la permanence</button>
        </div>
    </div>

    <!-- MODALE FICHE CONTACT (intelligente) -->
    <div id="modal-fiche-contact" class="modal-overlay hidden">
        <div class="modal-container">
            <div class="modal-header">
                <h2>üìã Nouvelle fiche contact</h2>
                <button class="close-btn" onclick="closeFicheContact()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="form-fiche-contact" onsubmit="submitFicheContact(event)">
                    <!-- Section: R√©f√©rences -->
                    <div class="form-section">
                        <div class="section-title">01 ‚Äî R√©f√©rences</div>
                        <div class="form-grid">
                            <div>
                                <label>ID Fiche <span class="text-muted">(auto)</span></label>
                                <input type="text" id="contact-id" readonly class="input" style="background:#f1f5f9;">
                            </div>
                            <div>
                                <label>Nature</label>
                                <select id="contact-nature" class="select">
                                    <option value="Premier contact">Premier contact</option>
                                    <option value="Suivi">Suivi</option>
                                </select>
                            </div>
                        </div>
                        <div id="prev-id-container" class="hidden" style="margin-top:1rem;">
                            <label>ID fiche pr√©c√©dente</label>
                            <input type="text" id="contact-prev-id" class="input">
                        </div>
                    </div>

                    <!-- Section: Type de demande (conditionne la suite) -->
                    <div class="form-section">
                        <div class="section-title">02 ‚Äî Type de demande</div>
                        <div>
                            <label>Cat√©gorie</label>
                            <select id="contact-categorie" class="select" onchange="categorieChange()" required>
                                <option value="">-- S√©lectionnez --</option>
                                <option value="beneficiaire">B√©n√©ficiaire (demande d'aide)</option>
                                <option value="partenaire">Partenaire / Prescripteur</option>
                                <option value="benevole">Candidat b√©n√©vole</option>
                                <option value="information">Demande d'information</option>
                            </select>
                        </div>
                    </div>

                    <!-- Section: Informations communes (toujours affich√©es) -->
                    <div class="form-section">
                        <div class="section-title">03 ‚Äî Coordonn√©es</div>
                        <div class="form-grid">
                            <div>
                                <label>Nom / Pr√©nom ou Structure</label>
                                <input type="text" id="contact-nom" class="input" required>
                            </div>
                            <div>
                                <label>T√©l√©phone</label>
                                <input type="tel" id="contact-tel" class="input">
                            </div>
                            <div>
                                <label>Email</label>
                                <input type="email" id="contact-email" class="input">
                            </div>
                        </div>
                    </div>

                    <!-- Section B√©n√©ficiaire (conditionnelle) -->
                    <div id="section-beneficiaire" class="form-section hidden">
                        <div class="section-title">04 ‚Äî Informations sociales (b√©n√©ficiaire)</div>
                        <div class="form-grid">
                            <div>
                                <label>Situation professionnelle</label>
                                <select id="benef-situation-pro" class="select">
                                    <option value="">-- S√©lectionnez --</option>
                                    <option>Sans emploi</option>
                                    <option>CDI/CDD</option>
                                    <option>Ind√©pendant</option>
                                    <option>√âtudiant</option>
                                    <option>Retrait√©</option>
                                </select>
                            </div>
                            <div>
                                <label>Ressources</label>
                                <select id="benef-ressources" class="select">
                                    <option>Aucune</option>
                                    <option>Minima sociaux (RSA, AAH)</option>
                                    <option>< SMIC</option>
                                    <option>> SMIC</option>
                                </select>
                            </div>
                            <div>
                                <label>Nombre d'enfants √† charge</label>
                                <input type="number" id="benef-enfants" class="input" min="0" value="0">
                            </div>
                        </div>
                        <div style="margin-top:1rem;">
                            <label>Situation administrative</label>
                            <select id="benef-situation-admin" class="select">
                                <option value="">-- S√©lectionnez --</option>
                                <option>Europ√©en (UE)</option>
                                <option>Titre de s√©jour valide</option>
                                <option>R√©c√©piss√©</option>
                                <option>Demande d'asile</option>
                                <option>Sans titre (OQTF)</option>
                            </select>
                        </div>
                        <div style="margin-top:1rem;">
                            <label>Nature de la demande</label>
                            <textarea id="benef-demande" class="input" rows="2" placeholder="D√©crire bri√®vement la demande..."></textarea>
                        </div>
                        <div style="margin-top:1rem;">
                            <label>Orientation propos√©e</label>
                            <select id="benef-orientation" class="select">
                                <option value="">-- S√©lectionnez --</option>
                                <option>Juridique</option>
                                <option>Psychologique</option>
                                <option>Social</option>
                                <option>KOOM</option>
                                <option>CARELINE</option>
                                <option>Collectes</option>
                                <option>Autre</option>
                            </select>
                        </div>
                        <!-- Champ Urgence -->
                        <div style="margin-top:1rem;">
                            <label>Niveau d'urgence</label>
                            <select id="benef-urgence" class="select">
                                <option value="Faible">Faible</option>
                                <option value="Moyenne">Moyenne</option>
                                <option value="Haute">Haute</option>
                            </select>
                        </div>
                    </div>

                    <!-- Section Partenaire (conditionnelle) -->
                    <div id="section-partenaire" class="form-section hidden">
                        <div class="section-title">04 ‚Äî Informations partenaire</div>
                        <div class="form-grid">
                            <div>
                                <label>Nom de la structure</label>
                                <input type="text" id="partenaire-structure" class="input">
                            </div>
                            <div>
                                <label>Type de structure</label>
                                <select id="partenaire-type" class="select">
                                    <option>Association</option>
                                    <option>Service public</option>
                                    <option>Entreprise</option>
                                    <option>Autre</option>
                                </select>
                            </div>
                            <div>
                                <label>Personne de contact (pr√©nom/nom)</label>
                                <input type="text" id="partenaire-contact" class="input">
                            </div>
                        </div>
                        <div style="margin-top:1rem;">
                            <label>Nature du partenariat</label>
                            <textarea id="partenaire-nature" class="input" rows="2" placeholder="Ex: convention, orientation mutuelle, mise √† disposition..."></textarea>
                        </div>
                    </div>

                    <!-- Section Candidat b√©n√©vole (conditionnelle) -->
                    <div id="section-benevole" class="form-section hidden">
                        <div class="section-title">04 ‚Äî Informations candidat b√©n√©vole</div>
                        <div class="form-grid">
                            <div>
                                <label>√Çge</label>
                                <input type="number" id="benevole-age" class="input" min="18">
                            </div>
                            <div>
                                <label>Profession / Comp√©tences</label>
                                <input type="text" id="benevole-competences" class="input">
                            </div>
                        </div>
                        <div style="margin-top:1rem;">
                            <label>Disponibilit√©s</label>
                            <input type="text" id="benevole-dispo" class="input" placeholder="ex: mercredi apr√®s-midi">
                        </div>
                        <div style="margin-top:1rem;">
                            <label>Mission souhait√©e</label>
                            <select id="benevole-mission" class="select">
                                <option>Accueil / Administration</option>
                                <option>Juridique</option>
                                <option>Terrain / Collectes</option>
                                <option>Communication</option>
                                <option>Autre</option>
                            </select>
                        </div>
                    </div>

                    <!-- Section Information simple (conditionnelle) -->
                    <div id="section-information" class="form-section hidden">
                        <div class="section-title">04 ‚Äî Demande d'information</div>
                        <div>
                            <label>Sujet de la demande</label>
                            <input type="text" id="info-sujet" class="input">
                        </div>
                        <div style="margin-top:1rem;">
                            <label>R√©ponse apport√©e / informations transmises</label>
                            <textarea id="info-reponse" class="input" rows="2"></textarea>
                        </div>
                    </div>

                    <!-- === NOUVELLE SECTION BIEN-√äTRE === -->
                    <div class="form-section">
                        <div class="section-title">‚ù§Ô∏è Bien-√™tre de la personne</div>
                        <div class="bienetre-container">
                            <label>Comment la personne se sent-elle aujourd'hui ?</label>
                            <div class="emojis-row" id="bienetre-emojis-contact">
                                <div class="emoji-option" data-value="tres-bien" onclick="selectionnerEmotion('contact', 'tres-bien')">
                                    <span>üòä</span>
                                    <span>Tr√®s bien</span>
                                </div>
                                <div class="emoji-option" data-value="bien" onclick="selectionnerEmotion('contact', 'bien')">
                                    <span>üôÇ</span>
                                    <span>Bien</span>
                                </div>
                                <div class="emoji-option" data-value="neutre" onclick="selectionnerEmotion('contact', 'neutre')">
                                    <span>üòê</span>
                                    <span>Neutre</span>
                                </div>
                                <div class="emoji-option" data-value="mal" onclick="selectionnerEmotion('contact', 'mal')">
                                    <span>üòî</span>
                                    <span>Mal</span>
                                </div>
                                <div class="emoji-option" data-value="tres-mal" onclick="selectionnerEmotion('contact', 'tres-mal')">
                                    <span>üò¢</span>
                                    <span>Tr√®s mal</span>
                                </div>
                            </div>
                            <input type="hidden" id="bienetre-contact" value="">
                            <div style="margin-top:1rem;">
                                <label>Pr√©cisions (optionnel)</label>
                                <textarea id="bienetre-contact-details" class="input" rows="2" placeholder="La personne souhaite-t-elle ajouter quelque chose ?"></textarea>
                            </div>
                            <div id="bienetre-reco-contact" class="bienetre-reco">
                                <!-- Les recommandations appara√Ætront ici dynamiquement -->
                            </div>
                        </div>
                    </div>

                    <!-- Section: Validation -->
                    <div class="form-section">
                        <div class="section-title">06 ‚Äî Validation</div>
                        <label class="checkbox-label">
                            <input type="checkbox" id="contact-valid" required>
                            <span>Je certifie l'exactitude des informations et atteste avoir recueilli le consentement de la personne (RGPD).</span>
                        </label>
                    </div>

                    <div style="display: flex; gap:1rem; justify-content: flex-end;">
                        <button type="button" class="btn btn-outline" onclick="closeFicheContact()">Annuler</button>
                        <button type="submit" class="btn btn-primary">Enregistrer la fiche</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- MODALE FICHE MOBILE JURIDIQUE (avec assistant int√©gr√©) -->
    <div id="modal-fiche-mobile" class="modal-overlay hidden">
        <div class="modal-container" style="max-width: 1000px;">
            <div class="modal-header">
                <h2>‚öñÔ∏è Dossier mobile juridique</h2>
                <button class="close-btn" onclick="closeFicheMobile()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="form-fiche-mobile" onsubmit="submitFicheMobile(event)">
                    <!-- Section: R√©f√©rences -->
                    <div class="form-section">
                        <div class="section-title">01 ‚Äî R√©f√©rences</div>
                        <div class="form-grid">
                            <div>
                                <label>ID Dossier</label>
                                <input type="text" id="mobile-id" readonly class="input" style="background:#f1f5f9;">
                            </div>
                            <div>
                                <label>Nature</label>
                                <select id="mobile-nature" class="select">
                                    <option>Premier contact</option>
                                    <option>Suivi</option>
                                </select>
                            </div>
                        </div>
                        <div id="mobile-prev-container" class="hidden" style="margin-top:1rem;">
                            <label>ID Dossier pr√©c√©dent</label>
                            <input type="text" id="mobile-prev-id" class="input">
                        </div>
                        <div style="margin-top:1rem;">
                            <label>Intervenant¬∑e principal¬∑e</label>
                            <input type="text" id="mobile-intervenant" class="input" required>
                        </div>
                    </div>

                    <!-- Section: Coordonn√©es -->
                    <div class="form-section">
                        <div class="section-title">02 ‚Äî Personne accompagn√©e</div>
                        <div class="form-grid">
                            <div>
                                <label>Nom / Pr√©nom</label>
                                <input type="text" id="mobile-nom" class="input" required>
                            </div>
                            <div>
                                <label>T√©l√©phone</label>
                                <input type="tel" id="mobile-tel" class="input">
                            </div>
                            <div>
                                <label>Email</label>
                                <input type="email" id="mobile-email" class="input">
                            </div>
                        </div>
                    </div>

                    <!-- Section: Profil -->
                    <div class="form-section">
                        <div class="section-title">03 ‚Äî Profil et situation</div>
                        <div class="form-grid">
                            <div>
                                <label>Situation professionnelle</label>
                                <select id="mobile-situation-pro" class="select">
                                    <option>Sans emploi</option>
                                    <option>Salari√©</option>
                                    <option>Ind√©pendant</option>
                                    <option>√âtudiant</option>
                                </select>
                            </div>
                            <div>
                                <label>Enfants √† charge</label>
                                <input type="number" id="mobile-enfants" class="input" min="0" value="0">
                            </div>
                        </div>
                        <div style="margin-top:1rem;">
                            <label>Situation administrative</label>
                            <select id="mobile-situation-admin" class="select" required>
                                <option value="">-- S√©lectionnez --</option>
                                <option>Europ√©en (UE)</option>
                                <option>Titre de s√©jour valide</option>
                                <option>R√©c√©piss√©</option>
                                <option>Demande d'asile</option>
                                <option>Sans titre (OQTF)</option>
                            </select>
                        </div>
                        <div style="margin-top:1rem;">
                            <label>Ressources</label>
                            <select id="mobile-ressources" class="select">
                                <option>Aucune</option>
                                <option>Minima sociaux</option>
                                <option>< SMIC</option>
                                <option>> SMIC</option>
                            </select>
                        </div>
                    </div>

                    <!-- Section: Juridique -->
                    <div class="form-section">
                        <div class="section-title">04 ‚Äî Dossier juridique</div>
                        <div class="form-grid">
                            <div>
                                <label>Th√©matique</label>
                                <select id="mobile-theme" class="select" required>
                                    <option>Famille</option>
                                    <option>Travail</option>
                                    <option>√âtrangers</option>
                                    <option>P√©nal</option>
                                    <option>Logement</option>
                                    <option>Consommation</option>
                                </select>
                            </div>
                            <div>
                                <label>Objet du litige</label>
                                <input type="text" id="mobile-objet" class="input" required>
                            </div>
                        </div>
                        <div style="margin-top:1rem;">
                            <label>Analyse confidentielle</label>
                            <textarea id="mobile-analyse" class="input" rows="3"></textarea>
                        </div>
                        <div style="margin-top:1rem;">
                            <label>√âtapes conseill√©es / actions r√©alis√©es</label>
                            <textarea id="mobile-etapes" class="input" rows="2"></textarea>
                        </div>
                        <div style="margin-top:1rem;">
                            <label>Aide juridictionnelle ?</label>
                            <select id="mobile-aj" class="select">
                                <option>Non</option>
                                <option>Demande en cours</option>
                                <option>Accord√©e</option>
                                <option>Refus√©e</option>
                            </select>
                        </div>
                        <div style="margin-top:1rem;">
                            <label>Structure relais (si orientation)</label>
                            <input type="text" id="mobile-relais" class="input" placeholder="Nom du partenaire">
                        </div>
                        <!-- Champ Urgence pour mobile -->
                        <div style="margin-top:1rem;">
                            <label>Niveau d'urgence</label>
                            <select id="mobile-urgence" class="select">
                                <option value="Faible">Faible</option>
                                <option value="Moyenne">Moyenne</option>
                                <option value="Haute">Haute</option>
                            </select>
                        </div>
                    </div>

                    <!-- === NOUVELLE SECTION BIEN-√äTRE POUR MOBILE === -->
                    <div class="form-section">
                        <div class="section-title">‚ù§Ô∏è Bien-√™tre de la personne</div>
                        <div class="bienetre-container">
                            <label>Comment la personne se sent-elle aujourd'hui ?</label>
                            <div class="emojis-row" id="bienetre-emojis-mobile">
                                <div class="emoji-option" data-value="tres-bien" onclick="selectionnerEmotion('mobile', 'tres-bien')">
                                    <span>üòä</span>
                                    <span>Tr√®s bien</span>
                                </div>
                                <div class="emoji-option" data-value="bien" onclick="selectionnerEmotion('mobile', 'bien')">
                                    <span>üôÇ</span>
                                    <span>Bien</span>
                                </div>
                                <div class="emoji-option" data-value="neutre" onclick="selectionnerEmotion('mobile', 'neutre')">
                                    <span>üòê</span>
                                    <span>Neutre</span>
                                </div>
                                <div class="emoji-option" data-value="mal" onclick="selectionnerEmotion('mobile', 'mal')">
                                    <span>üòî</span>
                                    <span>Mal</span>
                                </div>
                                <div class="emoji-option" data-value="tres-mal" onclick="selectionnerEmotion('mobile', 'tres-mal')">
                                    <span>üò¢</span>
                                    <span>Tr√®s mal</span>
                                </div>
                            </div>
                            <input type="hidden" id="bienetre-mobile" value="">
                            <div style="margin-top:1rem;">
                                <label>Pr√©cisions (optionnel)</label>
                                <textarea id="bienetre-mobile-details" class="input" rows="2" placeholder="La personne souhaite-t-elle ajouter quelque chose ?"></textarea>
                            </div>
                            <div id="bienetre-reco-mobile" class="bienetre-reco">
                                <!-- Les recommandations appara√Ætront ici dynamiquement -->
                            </div>
                        </div>
                    </div>

                    <!-- Section: Validation RGPD -->
                    <div class="form-section">
                        <div class="section-title">06 ‚Äî Validation</div>
                        <label class="checkbox-label">
                            <input type="checkbox" id="mobile-valid" required>
                            <span>Je certifie l'exactitude des informations et atteste avoir recueilli le consentement (RGPD).</span>
                        </label>
                        <div style="margin-top:1rem;">
                            <label>Consentement RGPD</label>
                            <select id="mobile-rgpd" class="select">
                                <option>Consentement recueilli</option>
                                <option>Refus de consentement</option>
                            </select>
                        </div>
                    </div>

                    <!-- Boutons d'action : Analyse et envoi -->
                    <div style="display: flex; gap:1rem; justify-content: space-between; margin: 2rem 0;">
                        <button type="button" class="btn btn-outline" onclick="analyserFicheMobile()">üîç Analyser la situation</button>
                        <div>
                            <button type="button" class="btn btn-outline" onclick="closeFicheMobile()">Annuler</button>
                            <button type="submit" class="btn btn-primary">Transmettre le dossier</button>
                        </div>
                    </div>

                    <!-- Zone d'affichage du rapport juridique -->
                    <div id="rapport-mobile"></div>
                </form>
            </div>
        </div>
    </div>

    <!-- MODALE FIN DE SESSION -->
    <div id="modal-logout" class="modal-overlay hidden">
        <div class="modal-container" style="max-width:480px; text-align:center; padding:2rem;">
            <h2 style="color: var(--lge-green); font-weight:800; margin-bottom:1rem;">Session termin√©e</h2>
            <p id="logout-summary" style="margin-bottom:2rem; color:var(--text-secondary);"></p>
            <button class="btn btn-primary" onclick="fermerTout()">Retour √† l'accueil</button>
        </div>
    </div>

    <script>
        // ================== CONFIG ==================
        const APPS_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzLk1Wryy2yGnr5qp3FcaqnWX319DiLIh_wzXXky5SINwElHG31tDOQUXgHRMDP_4zz/exec";

        // ================== GESTION DE L'HORLOGE ==================
        function updateClock() {
            const now = new Date();
            document.getElementById('date-now').innerText = now.toLocaleDateString('fr-FR', { weekday: 'short', day: 'numeric', month: 'short' });
            document.getElementById('time-now').innerText = now.toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' });
        }
        setInterval(updateClock, 1000);

        // ================== CONNEXION / SESSION ==================
        function demarrerPermanence(e) {
            e.preventDefault();
            const email = document.getElementById('email-input').value.trim();
            const type = document.getElementById('permanence-type').value;
            if (!email.includes('@')) {
                alert("Veuillez entrer un email valide.");
                return;
            }
            const now = new Date();
            localStorage.setItem('lge_email', email);
            localStorage.setItem('lge_start', now.toISOString());
            localStorage.setItem('lge_type', type);
            lancerInterface(email, now, type);
        }

        function lancerInterface(email, start, type) {
            document.getElementById('login-screen').classList.add('hidden');
            document.getElementById('dashboard').classList.remove('hidden');
            document.getElementById('user-display').innerText = email;
            document.getElementById('start-time-display').innerText = start.toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' });
            document.getElementById('permanence-type-display').innerText = type === 'classique' ? 'Classique' : 'Mobile Juridique';

            if (type === 'classique') {
                document.getElementById('dashboard-classique').classList.remove('hidden');
                document.getElementById('dashboard-mobile').classList.add('hidden');
            } else {
                document.getElementById('dashboard-mobile').classList.remove('hidden');
                document.getElementById('dashboard-classique').classList.add('hidden');
            }
        }

        // ================== FICHE CONTACT (modale intelligente) ==================
        function openFicheContact() {
            document.getElementById('contact-id').value = 'FC-' + Date.now().toString().slice(-8);
            resetFicheContact();
            document.getElementById('form-fiche-contact').reset();
            document.getElementById('contact-categorie').value = '';
            document.getElementById('section-beneficiaire').classList.add('hidden');
            document.getElementById('section-partenaire').classList.add('hidden');
            document.getElementById('section-benevole').classList.add('hidden');
            document.getElementById('section-information').classList.add('hidden');
            document.getElementById('prev-id-container').classList.add('hidden');
            // R√©initialiser la section bien-√™tre
            document.getElementById('bienetre-contact').value = '';
            document.getElementById('bienetre-contact-details').value = '';
            document.getElementById('bienetre-reco-contact').innerHTML = '';
            document.querySelectorAll('#bienetre-emojis-contact .emoji-option').forEach(el => el.classList.remove('selected'));
            document.getElementById('modal-fiche-contact').classList.remove('hidden');
        }

        function resetFicheContact() {
            document.getElementById('benef-situation-pro').value = '';
            document.getElementById('benef-ressources').value = 'Aucune';
            document.getElementById('benef-enfants').value = '0';
            document.getElementById('benef-situation-admin').value = '';
            document.getElementById('benef-demande').value = '';
            document.getElementById('benef-orientation').value = '';
            document.getElementById('benef-urgence').value = 'Faible';
            document.getElementById('partenaire-structure').value = '';
            document.getElementById('partenaire-type').value = 'Association';
            document.getElementById('partenaire-contact').value = '';
            document.getElementById('partenaire-nature').value = '';
            document.getElementById('benevole-age').value = '';
            document.getElementById('benevole-competences').value = '';
            document.getElementById('benevole-dispo').value = '';
            document.getElementById('benevole-mission').value = 'Accueil / Administration';
            document.getElementById('info-sujet').value = '';
            document.getElementById('info-reponse').value = '';
        }

        function closeFicheContact() {
            document.getElementById('modal-fiche-contact').classList.add('hidden');
        }

        function categorieChange() {
            const cat = document.getElementById('contact-categorie').value;
            document.getElementById('section-beneficiaire').classList.add('hidden');
            document.getElementById('section-partenaire').classList.add('hidden');
            document.getElementById('section-benevole').classList.add('hidden');
            document.getElementById('section-information').classList.add('hidden');
            if (cat === 'beneficiaire') {
                document.getElementById('section-beneficiaire').classList.remove('hidden');
            } else if (cat === 'partenaire') {
                document.getElementById('section-partenaire').classList.remove('hidden');
            } else if (cat === 'benevole') {
                document.getElementById('section-benevole').classList.remove('hidden');
            } else if (cat === 'information') {
                document.getElementById('section-information').classList.remove('hidden');
            }
        }

        document.getElementById('contact-nature')?.addEventListener('change', function(e) {
            const container = document.getElementById('prev-id-container');
            container.classList.toggle('hidden', e.target.value !== 'Suivi');
        });

        async function submitFicheContact(e) {
            e.preventDefault();
            const payload = {
                type_permanence: 'classique',
                fiche_id: document.getElementById('contact-id').value,
                nature: document.getElementById('contact-nature').value,
                dossier_precedent: document.getElementById('contact-prev-id').value || '',
                categorie: document.getElementById('contact-categorie').value,
                nom: document.getElementById('contact-nom').value,
                telephone: document.getElementById('contact-tel').value,
                email: document.getElementById('contact-email').value,
                bienetre: document.getElementById('bienetre-contact').value,
                bienetre_details: document.getElementById('bienetre-contact-details').value,
                benevole: localStorage.getItem('lge_email'),
                start_session: localStorage.getItem('lge_start')
            };

            const cat = payload.categorie;
            if (cat === 'beneficiaire') {
                payload.situation_pro = document.getElementById('benef-situation-pro').value;
                payload.ressources = document.getElementById('benef-ressources').value;
                payload.enfants = document.getElementById('benef-enfants').value;
                payload.situation_admin = document.getElementById('benef-situation-admin').value;
                payload.demande = document.getElementById('benef-demande').value;
                payload.orientation = document.getElementById('benef-orientation').value;
                payload.urgence = document.getElementById('benef-urgence').value;
            } else if (cat === 'partenaire') {
                payload.structure = document.getElementById('partenaire-structure').value;
                payload.type_structure = document.getElementById('partenaire-type').value;
                payload.contact_partenaire = document.getElementById('partenaire-contact').value;
                payload.nature_partenariat = document.getElementById('partenaire-nature').value;
            } else if (cat === 'benevole') {
                payload.age = document.getElementById('benevole-age').value;
                payload.competences = document.getElementById('benevole-competences').value;
                payload.disponibilites = document.getElementById('benevole-dispo').value;
                payload.mission = document.getElementById('benevole-mission').value;
            } else if (cat === 'information') {
                payload.sujet = document.getElementById('info-sujet').value;
                payload.reponse = document.getElementById('info-reponse').value;
            }

            try {
                const response = await fetch(APPS_SCRIPT_URL, {
                    method: 'POST',
                    body: JSON.stringify(payload)
                });
                const result = await response.text();
                console.log('R√©ponse serveur :', result);
                alert('Fiche enregistr√©e avec succ√®s !');
                closeFicheContact();
            } catch (err) {
                alert('Erreur lors de l\'envoi : ' + err.message);
            }
        }

        // ================== FICHE MOBILE JURIDIQUE ==================
        function openFicheMobile() {
            document.getElementById('mobile-id').value = 'MJ-' + Date.now().toString().slice(-8);
            document.getElementById('form-fiche-mobile').reset();
            
            // R√©initialiser les champs sp√©cifiques
            document.getElementById('mobile-nature').value = 'Premier contact';
            document.getElementById('mobile-situation-pro').value = 'Sans emploi';
            document.getElementById('mobile-enfants').value = '0';
            document.getElementById('mobile-situation-admin').value = '';
            document.getElementById('mobile-ressources').value = 'Aucune';
            document.getElementById('mobile-theme').value = 'Famille';
            document.getElementById('mobile-urgence').value = 'Faible';
            document.getElementById('mobile-rgpd').value = 'Consentement recueilli';
            document.getElementById('mobile-prev-container').classList.add('hidden');
            // R√©initialiser la section bien-√™tre mobile
            document.getElementById('bienetre-mobile').value = '';
            document.getElementById('bienetre-mobile-details').value = '';
            document.getElementById('bienetre-reco-mobile').innerHTML = '';
            document.querySelectorAll('#bienetre-emojis-mobile .emoji-option').forEach(el => el.classList.remove('selected'));
            // Effacer le rapport pr√©c√©dent
            document.getElementById('rapport-mobile').innerHTML = '';
            
            document.getElementById('modal-fiche-mobile').classList.remove('hidden');
        }

        function closeFicheMobile() {
            document.getElementById('modal-fiche-mobile').classList.add('hidden');
            document.getElementById('rapport-mobile').innerHTML = '';
        }

        document.getElementById('mobile-nature')?.addEventListener('change', function(e) {
            const container = document.getElementById('mobile-prev-container');
            container.classList.toggle('hidden', e.target.value !== 'Suivi');
        });

        async function submitFicheMobile(e) {
            e.preventDefault();
            const payload = {
                type_permanence: 'mobile_juridique',
                fiche_id: document.getElementById('mobile-id').value,
                nature: document.getElementById('mobile-nature').value,
                dossier_precedent: document.getElementById('mobile-prev-id').value || '',
                intervenant: document.getElementById('mobile-intervenant').value,
                nom: document.getElementById('mobile-nom').value,
                telephone: document.getElementById('mobile-tel').value,
                email: document.getElementById('mobile-email').value,
                situation_pro: document.getElementById('mobile-situation-pro').value,
                enfants: document.getElementById('mobile-enfants').value,
                situation_admin: document.getElementById('mobile-situation-admin').value,
                ressources: document.getElementById('mobile-ressources').value,
                theme: document.getElementById('mobile-theme').value,
                objet: document.getElementById('mobile-objet').value,
                analyse: document.getElementById('mobile-analyse').value,
                etapes: document.getElementById('mobile-etapes').value,
                aj: document.getElementById('mobile-aj').value,
                relais: document.getElementById('mobile-relais').value,
                urgence: document.getElementById('mobile-urgence').value,
                rgpd: document.getElementById('mobile-rgpd').value,
                bienetre: document.getElementById('bienetre-mobile').value,
                bienetre_details: document.getElementById('bienetre-mobile-details').value,
                benevole: localStorage.getItem('lge_email'),
                start_session: localStorage.getItem('lge_start')
            };
            try {
                const response = await fetch(APPS_SCRIPT_URL, {
                    method: 'POST',
                    body: JSON.stringify(payload)
                });
                const result = await response.text();
                console.log('R√©ponse serveur :', result);
                alert('Dossier transmis !');
                closeFicheMobile();
            } catch (err) {
                alert('Erreur : ' + err.message);
            }
        }

        // ================== SECTION BIEN-√äTRE ==================
        function selectionnerEmotion(formType, value) {
            // Mettre √† jour le champ cach√©
            document.getElementById(`bienetre-${formType}`).value = value;
            
            // Mettre en surbrillance l'√©motion s√©lectionn√©e
            const emojisRow = document.getElementById(`bienetre-emojis-${formType}`);
            emojisRow.querySelectorAll('.emoji-option').forEach(el => {
                el.classList.remove('selected');
            });
            event.currentTarget.classList.add('selected');
            
            // G√©n√©rer les recommandations
            genererRecommandationsBienetre(formType, value);
        }

        function genererRecommandationsBienetre(formType, niveau) {
            const recoDiv = document.getElementById(`bienetre-reco-${formType}`);
            let message = '';
            
            switch(niveau) {
                case 'tres-bien':
                case 'bien':
                    message = `
                        <p><strong>üëç C'est une bonne nouvelle !</strong> Voici quelques activit√©s propos√©es par l'association :</p>
                        <ul>
                            <li>Atelier bien-√™tre (relaxation, sophrologie) - tous les mercredis √† 14h</li>
                            <li>Sortie conviviale (caf√©-rencontre) - vendredi 10h</li>
                            <li>Activit√©s cr√©atives (peinture, √©criture) - sur inscription</li>
                        </ul>
                        <p>Pour plus d'informations, contactez l'accueil.</p>
                    `;
                    break;
                case 'neutre':
                    message = `
                        <p><strong>üßò Un petit boost ?</strong> Nous proposons des ateliers pour retrouver de l'√©nergie :</p>
                        <ul>
                            <li>Atelier "Mieux-√™tre" (gestion du stress) - mardi 10h</li>
                            <li>Groupe de parole - jeudi 14h</li>
                            <li>Activit√©s douces (yoga, m√©ditation) - lundi et vendredi</li>
                        </ul>
                        <p>Vous pouvez aussi discuter avec un b√©n√©vole form√© √† l'√©coute.</p>
                    `;
                    break;
                case 'mal':
                case 'tres-mal':
                    message = `
                        <p><strong>üÜò Vous traversez une p√©riode difficile ?</strong> Des ressources sont disponibles :</p>
                        <ul>
                            <li><strong>CARELINE</strong> (√©coute psychologique) : <a href="https://wa.me/33784812030" target="_blank">07 84 81 20 30</a> (WhatsApp)</li>
                            <li><strong>Permanence psychologique</strong> sur rendez-vous (contacter l'accueil)</li>
                            <li><strong>Num√©ros d'urgence :</strong> 3114 (pr√©vention suicide), 39 19 (violences femmes)</li>
                            <li>Accompagnement personnalis√© par un b√©n√©vole r√©f√©rent</li>
                        </ul>
                        <p>N'h√©sitez pas √† en parler, nous sommes l√† pour vous soutenir.</p>
                    `;
                    break;
                default:
                    message = '<p>S√©lectionnez une √©motion pour voir des recommandations.</p>';
            }
            
            recoDiv.innerHTML = message;
        }

        // ================== ASSISTANT JURIDIQUE INTELLIGENT ==================
        // Base de connaissances simul√©e (identique √† avant)
        const baseConnaissances = {
            etrangers: {
                asile: {
                    resume: "Demande d'asile : protection internationale.",
                    loi: "La demande d'asile est r√©gie par le CESEDA (Code de l'entr√©e et du s√©jour des √©trangers et du droit d'asile). L'OFPRA instruit les demandes.",
                    pieces: [
                        "R√©c√©piss√© de demande d'asile (en cours)",
                        "Passeport ou document d'identit√©",
                        "Actes d'√©tat civil (traduits si n√©cessaire)",
                        "Courriers de l'OFPRA ou de la CNDA",
                        "Documents prouvant les pers√©cutions (t√©moignages, certificats m√©dicaux, articles de presse)"
                    ],
                    orientation: [
                        "Consultez le site de l'OFPRA : https://ofpra.gouv.fr/",
                        "Contactez une association sp√©cialis√©e (France Terre d'Asile, etc.)",
                        "Num√©ro d'urgence asile : 01 53 69 53 70"
                    ]
                },
                titre_sejour_violence: {
                    resume: "Victime de violences conjugales demandant un titre de s√©jour.",
                    loi: "Une carte de s√©jour 'vie priv√©e et familiale' peut √™tre d√©livr√©e √† une personne √©trang√®re victime de violences conjugales, m√™me en situation irr√©guli√®re (art. L. 425-6 CESEDA).",
                    pieces: [
                        "Plainte ou r√©c√©piss√© de d√©p√¥t de plainte",
                        "Ordonnance de protection du juge aux affaires familiales (si obtenue)",
                        "Certificats m√©dicaux d√©taill√©s",
                        "Passeport",
                        "Justificatif de domicile",
                        "Photos des violences, t√©moignages"
                    ],
                    orientation: [
                        "Contactez le 39 19 (Violences femmes info)",
                        "Prenez rendez-vous avec une association sp√©cialis√©e (CIDFF, etc.)",
                        "Simulateur d'aide juridictionnelle : https://www.justice.fr/simulateur/aide-juridictionnelle"
                    ]
                }
            },
            famille: {
                divorce: {
                    resume: "Proc√©dure de divorce.",
                    loi: "Le divorce peut √™tre prononc√© par consentement mutuel, acceptation du principe de la rupture, alt√©ration d√©finitive du lien conjugal, ou pour faute. La proc√©dure d√©pend de la situation.",
                    pieces: [
                        "Acte de mariage",
                        "Livret de famille",
                        "Contrat de mariage (si existant)",
                        "Justificatifs de revenus (bulletins de salaire, avis d'imposition)",
                        "Projet de convention de divorce (pour consentement mutuel)"
                    ],
                    orientation: [
                        "Consultez un avocat sp√©cialis√© en droit de la famille",
                        "Point-Justice le plus proche : https://www.annuaires.justice.fr/",
                        "Simulateur de pension alimentaire : https://www.justice.fr/simulateur/pension-alimentaire"
                    ]
                },
                enfant: {
                    resume: "Garde d'enfant, pension alimentaire.",
                    loi: "L'autorit√© parentale est exerc√©e conjointement par les deux parents. En cas de s√©paration, le juge aux affaires familiales fixe la r√©sidence de l'enfant et la contribution √† son entretien.",
                    pieces: [
                        "Livret de famille",
                        "Jugements pr√©c√©dents (si d√©j√† saisi)",
                        "Bulletins de salaire des deux parents",
                        "Justificatif de domicile",
                        "Attestation de scolarit√©"
                    ],
                    orientation: [
                        "M√©diation familiale recommand√©e",
                        "Consultez le site : https://www.service-public.fr/particuliers/vosdroits/F1321"
                    ]
                }
            },
            travail: {
                licenciement: {
                    resume: "Litige li√© √† un licenciement.",
                    loi: "Le licenciement doit √™tre justifi√© par une cause r√©elle et s√©rieuse. En cas de contestation, le salari√© peut saisir le conseil de prud'hommes.",
                    pieces: [
                        "Lettre de licenciement",
                        "Contrat de travail",
                        "Bulletins de salaire des 12 derniers mois",
                        "Correspondances avec l'employeur",
                        "Justificatifs des indemnit√©s per√ßues (P√¥le emploi)"
                    ],
                    orientation: [
                        "Consultez un avocat en droit du travail",
                        "Saisine du conseil de prud'hommes : https://www.justice.fr/ prudhommes",
                        "Contactez l'inspection du travail"
                    ]
                }
            },
            logement: {
                impayes: {
                    resume: "Impay√©s de loyer, risque d'expulsion.",
                    loi: "En cas d'impay√©s, le propri√©taire doit d√©livrer un commandement de payer. Si la situation persiste, il peut saisir le juge. La tr√™ve hivernale prot√®ge les locataires de novembre √† mars.",
                    pieces: [
                        "Bail",
                        "Quittances de loyer",
                        "Commandement de payer (si re√ßu)",
                        "Justificatifs de situation (ressources, dettes)",
                        "Correspondances avec le propri√©taire"
                    ],
                    orientation: [
                        "Contactez la CAF pour une aide au logement (APL)",
                        "Saisissez le FSL (Fonds de Solidarit√© Logement)",
                        "Num√©ro d'urgence logement : 115",
                        "Consultez l'ADIL : https://www.anil.org/"
                    ]
                }
            }
        };

        function analyserSituationJuridique(donnees) {
            let rapport = {
                resume: "",
                loi: "",
                pieces: [],
                orientation: [],
                sources: []
            };

            const theme = donnees.theme || "";
            const objet = (donnees.objet || "").toLowerCase();
            const situationAdmin = donnees.situation_admin || "";
            const motsCles = objet + " " + theme + " " + situationAdmin;

            if (theme === "√âtrangers") {
                if (situationAdmin === "Demande d'asile" || motsCles.includes("asile")) {
                    rapport = { ...rapport, ...baseConnaissances.etrangers.asile };
                    rapport.sources.push("Service-Public.fr - Demande d'asile : https://www.service-public.fr/particuliers/vosdroits/F2210");
                    rapport.sources.push("CESEDA - Articles L. 511-1 et suivants");
                } else if (motsCles.includes("violence") || motsCles.includes("victime")) {
                    rapport = { ...rapport, ...baseConnaissances.etrangers.titre_sejour_violence };
                    rapport.sources.push("Service-Public.fr - Victime de violence : https://www.service-public.fr/particuliers/vosdroits/F2881");
                    rapport.sources.push("CESEDA - Article L. 425-6");
                }
            } else if (theme === "Famille") {
                if (motsCles.includes("divorce")) {
                    rapport = { ...rapport, ...baseConnaissances.famille.divorce };
                    rapport.sources.push("Service-Public.fr - Divorce : https://www.service-public.fr/particuliers/vosdroits/F1074");
                } else if (motsCles.includes("enfant") || motsCles.includes("garde")) {
                    rapport = { ...rapport, ...baseConnaissances.famille.enfant };
                    rapport.sources.push("Service-Public.fr - Garde d'enfant : https://www.service-public.fr/particuliers/vosdroits/F1321");
                }
            } else if (theme === "Travail") {
                if (motsCles.includes("licenciement")) {
                    rapport = { ...rapport, ...baseConnaissances.travail.licenciement };
                    rapport.sources.push("Service-Public.fr - Licenciement : https://www.service-public.fr/particuliers/vosdroits/F115");
                    rapport.sources.push("Code du travail - Articles L. 1232-1 et suivants");
                }
            } else if (theme === "Logement") {
                if (motsCles.includes("impay√©") || motsCles.includes("expulsion")) {
                    rapport = { ...rapport, ...baseConnaissances.logement.impayes };
                    rapport.sources.push("Service-Public.fr - Impay√©s de loyer : https://www.service-public.fr/particuliers/vosdroits/F134");
                    rapport.sources.push("Loi n¬∞ 89-462 du 6 juillet 1989");
                }
            }

            if (!rapport.loi) {
                rapport.resume = "Situation non sp√©cifique. Consultez les sources g√©n√©rales.";
                rapport.pieces = ["Liste g√©n√©rique : identit√©, justificatifs de situation, documents relatifs √† l'objet."];
                rapport.orientation = [
                    "Point-Justice le plus proche : https://www.annuaires.justice.fr/",
                    "Num√©ro d'acc√®s au droit : 30 39"
                ];
                rapport.sources = [
                    "Service-Public.fr - Recherche par th√®me : https://www.service-public.fr/",
                    "L√©gifrance - Textes de loi : https://www.legifrance.gouv.fr/"
                ];
            }

            return rapport;
        }

        function afficherRapport(rapport, elementId) {
            const container = document.getElementById(elementId);
            if (!container) return;

            let html = '<div class="rapport-juridique">';
            html += `<h4>üìã R√©sum√© de la situation</h4><p>${rapport.resume}</p>`;
            
            if (rapport.loi) {
                html += `<h4>‚öñÔ∏è Ce que dit la loi</h4><p>${rapport.loi}</p>`;
            }
            
            if (rapport.pieces && rapport.pieces.length) {
                html += `<h4>üìé Pi√®ces √† fournir</h4><ul>`;
                rapport.pieces.forEach(p => html += `<li>${p}</li>`);
                html += `</ul>`;
            }
            
            if (rapport.orientation && rapport.orientation.length) {
                html += `<h4>üó∫Ô∏è Orientations et recommandations</h4><ul>`;
                rapport.orientation.forEach(o => html += `<li>${o}</li>`);
                html += `</ul>`;
            }
            
            if (rapport.sources && rapport.sources.length) {
                html += `<div class="source"><strong>Sources :</strong><ul>`;
                rapport.sources.forEach(s => {
                    if (s.startsWith("http")) {
                        html += `<li><a href="${s}" target="_blank">${s}</a></li>`;
                    } else {
                        html += `<li>${s}</li>`;
                    }
                });
                html += `</ul></div>`;
            }
            
            html += '</div>';
            container.innerHTML = html;
        }

        function analyserFicheMobile() {
            const donnees = {
                theme: document.getElementById('mobile-theme').value,
                objet: document.getElementById('mobile-objet').value,
                situation_admin: document.getElementById('mobile-situation-admin').value,
                situation_pro: document.getElementById('mobile-situation-pro').value,
                ressources: document.getElementById('mobile-ressources').value,
                enfants: document.getElementById('mobile-enfants').value
            };
            const rapport = analyserSituationJuridique(donnees);
            afficherRapport(rapport, 'rapport-mobile');
        }

        // ================== FIN DE SESSION ==================
        function confirmerDeconnexion() {
            const start = new Date(localStorage.getItem('lge_start'));
            const end = new Date();
            const diff = Math.floor((end - start) / 1000);
            const heures = Math.floor(diff / 3600);
            const minutes = Math.floor((diff % 3600) / 60);
            const resume = `B√©n√©vole : ${localStorage.getItem('lge_email')}\nDur√©e : ${heures}h ${minutes}min\nD√©but : ${start.toLocaleString()}`;
            document.getElementById('logout-summary').innerText = resume;
            document.getElementById('modal-logout').classList.remove('hidden');

            fetch(APPS_SCRIPT_URL, {
                method: 'POST',
                body: JSON.stringify({
                    type: 'fin_session',
                    email: localStorage.getItem('lge_email'),
                    start: start.toISOString(),
                    end: end.toISOString(),
                    duree: `${heures}h${minutes}`
                })
            }).catch(err => console.log('Fin session logg√©e'));
        }

        function fermerTout() {
            localStorage.clear();
            location.reload();
        }

        // ================== R√âINITIALISATION AU CHARGEMENT ==================
        window.onload = function() {
            updateClock();
            const email = localStorage.getItem('lge_email');
            if (email) {
                const start = new Date(localStorage.getItem('lge_start'));
                const type = localStorage.getItem('lge_type');
                lancerInterface(email, start, type);
            }
        };
    </script>
</body>
</html>
