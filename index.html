<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LGE - Permanence Op√©rationnelle</title>
    <style>
        /* ========== STYLES GLOBAUX ========== */
        :root {
            --lge-green: #2e7d32;
            --lge-green-light: #e8f5e9;
            --lge-green-dark: #1b5e20;
            --bg: #f8fafc;
            --text-primary: #0f172a;
            --text-secondary: #64748b;
            --white: #ffffff;
            --border: #e2e8f0;
            --radius-lg: 24px;
            --radius-md: 16px;
            --radius-sm: 12px;
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.05);
            --shadow-md: 0 4px 12px rgba(0,0,0,0.05);
            --shadow-lg: 0 20px 30px -10px rgba(0,0,0,0.1);
            --transition: all 0.2s ease;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg);
            color: var(--text-primary);
            line-height: 1.5;
            min-height: 100vh;
        }
        .hidden { display: none !important; }
        .btn {
            display: inline-flex; align-items: center; justify-content: center;
            padding: 0.75rem 1.5rem; border-radius: var(--radius-md);
            font-weight: 600; border: none; cursor: pointer;
            transition: var(--transition);
            background: var(--white); color: var(--text-primary); border: 1px solid var(--border);
        }
        .btn-primary {
            background: var(--lge-green); color: white; border: none;
            box-shadow: 0 2px 8px rgba(46,125,50,0.2);
        }
        .btn-primary:hover {
            background: var(--lge-green-dark); transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(46,125,50,0.3);
        }
        .btn-outline { background: transparent; }
        .btn-outline:hover { background: #f1f5f9; }
        .input, .select, textarea {
            width: 100%; padding: 0.75rem 1rem;
            border: 1.5px solid var(--border); border-radius: var(--radius-sm);
            font-family: inherit; font-size: 0.95rem;
            transition: var(--transition); background: var(--white);
        }
        .input:focus, .select:focus, textarea:focus {
            border-color: var(--lge-green);
            box-shadow: 0 0 0 3px rgba(46,125,50,0.1);
            outline: none;
        }
        label { font-weight: 600; font-size: 0.9rem; display: block; margin-bottom: 0.4rem; }
        .section-title {
            font-size: 0.8rem; text-transform: uppercase; font-weight: 700;
            color: var(--lge-green); background: var(--lge-green-light);
            display: inline-block; padding: 0.3rem 1rem; border-radius: 20px;
            margin-bottom: 1.5rem;
        }
        .form-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 1.5rem; margin-bottom: 1.5rem;
        }
        /* ========== CONNEXION ========== */
        #login-screen {
            display: flex; align-items: center; justify-content: center;
            min-height: 100vh; padding: 2rem;
            background: radial-gradient(circle at 10% 20%, #f0fdf4, #f8fafc);
        }
        .login-card {
            max-width: 480px; width: 100%; background: var(--white);
            border-radius: var(--radius-lg); overflow: hidden; box-shadow: var(--shadow-lg);
        }
        .login-header {
            background: var(--lge-green); color: white; padding: 3rem 2rem; text-align: center;
        }
        .login-body { padding: 2.5rem 2rem; }
        /* ========== DASHBOARD ========== */
        .app-header {
            background: rgba(255,255,255,0.8); backdrop-filter: blur(12px);
            padding: 1rem 2rem; border-bottom: 2px solid var(--lge-green);
            display: flex; justify-content: space-between; align-items: center;
            position: sticky; top: 0; z-index: 50;
        }
        .container { max-width: 1280px; margin: 2rem auto; padding: 0 2rem; }
        .session-info {
            display: flex; gap: 1rem; flex-wrap: wrap;
            background: var(--white); padding: 1rem 1.5rem;
            border-radius: var(--radius-md); border: 1px solid var(--border);
            margin-bottom: 2rem;
        }
        .badge {
            background: var(--lge-green-light); color: var(--lge-green-dark);
            padding: 0.25rem 0.75rem; border-radius: 50px; font-weight: 600;
        }
        /* Onglets de navigation */
        .tab-bar {
            display: flex; gap: 1rem; border-bottom: 2px solid var(--border);
            margin-bottom: 2rem; padding-bottom: 0.5rem;
        }
        .tab {
            padding: 0.5rem 1rem; font-weight: 600; cursor: pointer;
            border-radius: var(--radius-sm) var(--radius-sm) 0 0;
            transition: var(--transition);
        }
        .tab.active {
            background: var(--lge-green-light); color: var(--lge-green-dark);
            border-bottom: 3px solid var(--lge-green);
        }
        /* Grille des actions */
        .action-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
            gap: 1.5rem; margin-bottom: 2rem;
        }
        .action-card {
            display: block; text-decoration: none; color: inherit;
            background: var(--white); border-radius: var(--radius-md);
            border: 1px solid var(--border); padding: 1.8rem 1.5rem;
            transition: var(--transition); cursor: pointer;
            position: relative; overflow: hidden;
        }
        .action-card:hover {
            transform: translateY(-4px); border-color: var(--lge-green);
            box-shadow: var(--shadow-lg);
        }
        .action-card::after {
            content: ''; position: absolute; bottom: 0; left: 0;
            width: 100%; height: 4px; background: var(--border);
            transition: background 0.2s;
        }
        .action-card:hover::after { background: var(--lge-green); }
        .action-title { font-weight: 700; font-size: 1.25rem; margin-bottom: 0.5rem; }
        .action-desc { color: var(--text-secondary); font-size: 0.9rem; }
        /* ========== MODALES ========== */
        .modal-overlay {
            position: fixed; inset: 0; background: rgba(15,23,42,0.3);
            backdrop-filter: blur(8px); display: flex; align-items: center;
            justify-content: center; z-index: 1000; padding: 1.5rem;
        }
        .modal-container {
            background: var(--white); border-radius: var(--radius-lg);
            width: 100%; max-width: 1000px; max-height: 90vh;
            overflow-y: auto; box-shadow: var(--shadow-lg);
            animation: modalFadeIn 0.2s ease;
        }
        @keyframes modalFadeIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
        .modal-header {
            padding: 1.5rem 2rem; border-bottom: 1px solid var(--border);
            display: flex; justify-content: space-between; align-items: center;
            position: sticky; top: 0; background: var(--white); z-index: 10;
        }
        .modal-header h2 { font-size: 1.5rem; font-weight: 700; }
        .close-btn {
            background: #f1f5f9; border: none; width: 40px; height: 40px;
            border-radius: 50%; display: flex; align-items: center;
            justify-content: center; font-size: 1.5rem; cursor: pointer;
        }
        .modal-body { padding: 2rem; }
        .form-section {
            margin-bottom: 2.5rem; padding-bottom: 1.5rem;
            border-bottom: 1px solid var(--border);
        }
        .form-section:last-child { border-bottom: none; margin-bottom: 0; padding-bottom: 0; }
        .checkbox-label {
            display: flex; align-items: center; gap: 0.75rem; font-weight: 500;
            cursor: pointer;
        }
        .checkbox-label input[type="checkbox"] {
            width: 1.2rem; height: 1.2rem; accent-color: var(--lge-green);
        }
        .btn-logout {
            width: 100%; padding: 1rem; background: #fff; color: #ef4444;
            border: 2px solid #fee2e2; border-radius: var(--radius-md);
            font-weight: 700; text-transform: uppercase; cursor: pointer;
            margin: 2rem 0 1rem;
        }
        .btn-logout:hover { background: #fee2e2; }
        /* Assistant juridique */
        .rapport-juridique {
            background: #f0f9ff; border-left: 4px solid var(--lge-green);
            padding: 1.5rem; border-radius: var(--radius-md); margin-top: 2rem;
        }
        .rapport-juridique h4 {
            color: var(--lge-green-dark); margin: 1rem 0 0.5rem;
            font-size: 1rem; text-transform: uppercase;
        }
        .rapport-juridique ul { margin-left: 1.5rem; }
        .rapport-juridique .source {
            font-size: 0.85rem; color: var(--text-secondary);
            border-top: 1px solid var(--border); margin-top: 1rem; padding-top: 1rem;
        }
        .rapport-juridique a { color: var(--lge-green); text-decoration: none; }
        .rapport-juridique a:hover { text-decoration: underline; }
        /* Bien-√™tre */
        .bienetre-container {
            background: #fff3e0; border-radius: var(--radius-md);
            padding: 1.5rem; margin: 1rem 0;
        }
        .emojis-row {
            display: flex; gap: 1rem; justify-content: space-around;
            flex-wrap: wrap; margin: 1rem 0;
        }
        .emoji-option {
            display: flex; flex-direction: column; align-items: center;
            cursor: pointer; padding: 0.5rem; border-radius: var(--radius-sm);
            border: 2px solid transparent; transition: var(--transition);
        }
        .emoji-option.selected {
            border-color: var(--lge-green); background: var(--lge-green-light);
        }
        .emoji-option span:first-child { font-size: 2rem; }
        .emoji-option span:last-child { font-size: 0.8rem; font-weight: 600; }
        .bienetre-reco {
            background: white; padding: 1rem; border-radius: var(--radius-sm);
            border-left: 4px solid var(--lge-green); margin-top: 1rem;
        }
        @media (max-width: 640px) {
            .container { padding: 0 1rem; }
            .modal-header { padding: 1rem 1.5rem; }
            .modal-body { padding: 1.5rem; }
        }
    </style>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
</head>
<body>

<!-- ========== √âCRAN DE CONNEXION ========== -->
<div id="login-screen">
    <div class="login-card">
        <div class="login-header">
            <img src="https://lgedroitetjustice.fr/wp-content/uploads/2025/05/cropped-cropped-LOGO-2-282x300.png" height="90" alt="Logo LGE" style="filter: brightness(0) invert(1);">
            <h1 style="margin:1.5rem 0 0.5rem; font-weight:800;">LES GRAINES DE L'ESPOIR</h1>
            <p style="opacity:0.9;">Portail de Permanence</p>
        </div>
        <div class="login-body">
            <form id="login-form" onsubmit="demarrerPermanence(event)">
                <label>Email du b√©n√©vole</label>
                <input type="email" id="email-input" class="input" placeholder="prenom.nom@lge.fr" required>
                <label style="margin-top:1rem;">Type de permanence</label>
                <select id="permanence-type" class="select" required>
                    <option value="classique">Permanence Classique</option>
                    <option value="mobile_juridique">Permanence Mobile Juridique</option>
                </select>
                <button type="submit" class="btn btn-primary" style="width:100%; margin-top:2rem;">Lancer la session</button>
            </form>
        </div>
    </div>
</div>

<!-- ========== DASHBOARD PRINCIPAL ========== -->
<div id="dashboard" class="hidden">
    <header class="app-header">
        <div style="display:flex; align-items:center; gap:1rem;">
            <img src="https://lgedroitetjustice.fr/wp-content/uploads/2025/05/cropped-cropped-LOGO-2-282x300.png" height="40">
            <span class="font-bold">PERMANENCE OP√âRATIONNELLE</span>
        </div>
        <div id="live-clock" class="text-right">
            <div id="date-now" class="text-xs text-muted"></div>
            <div id="time-now" class="font-bold" style="color:var(--lge-green); font-size:1.2rem;"></div>
        </div>
    </header>

    <div class="container">
        <!-- Infos session -->
        <div class="session-info">
            <span class="badge" id="user-display"></span>
            <span>üïí D√©but : <span id="start-time-display"></span></span>
            <span>üìã Type : <span id="permanence-type-display"></span></span>
        </div>

        <!-- Onglets de navigation -->
        <div class="tab-bar">
            <div class="tab active" data-tab="classique" onclick="switchTab('classique')">üè¢ Permanence Classique</div>
            <div class="tab" data-tab="mobile" onclick="switchTab('mobile')">üöê Mobile Juridique</div>
        </div>

        <!-- Contenu de l'onglet Classique -->
        <div id="tab-classique" class="tab-content">
            <div class="action-grid">
                <div onclick="openFicheContact()" class="action-card">
                    <div class="action-title">üìã Nouvelle fiche contact</div>
                    <div class="action-desc">B√©n√©ficiaire, partenaire, b√©n√©vole, information</div>
                </div>
                <div onclick="openFicheJuridique()" class="action-card">
                    <div class="action-title">‚öñÔ∏è Fiche juridique approfondie</div>
                    <div class="action-desc">Dossier d√©taill√© pour situations complexes</div>
                </div>
                <a href="https://docs.google.com/spreadsheets/d/1HHgQbhCWtAS_LD93yFf9JncpuvCoXVod112bTr5wYmo/edit?usp=sharing" target="_blank" class="action-card">
                    <div class="action-title">üìû Annuaire interne</div>
                    <div class="action-desc">Contacts p√¥les et partenaires</div>
                </a>
                <a href="https://forms.gle/efW4RKVZF3tnEFts8" target="_blank" class="action-card">
                    <div class="action-title">üìù Compte-rendu de vacation</div>
                    <div class="action-desc">Bilan de fin de permanence</div>
                </a>
                <a href="https://drive.google.com/file/d/1ECDdNKRRwPsh5LN5Jq9xRC-cx6rvpOXz/view" target="_blank" class="action-card">
                    <div class="action-title">‚öñÔ∏è Protocole op√©rationnel</div>
                    <div class="action-desc">Cadre et proc√©dures</div>
                </a>
                <a href="https://calendar.app.google/vmuAcu8KPvzkd5vC8" target="_blank" class="action-card">
                    <div class="action-title">üìÖ R√©server un cr√©neau</div>
                    <div class="action-desc">Maison des Associations</div>
                </a>
                <a href="https://wa.me/33784812030" target="_blank" class="action-card" style="border-color:#25D366;">
                    <div class="action-title">üì± CARELINE WhatsApp</div>
                    <div class="action-desc">Contacter l'√©quipe soutien</div>
                </a>
            </div>
        </div>

        <!-- Contenu de l'onglet Mobile -->
        <div id="tab-mobile" class="tab-content hidden">
            <div class="action-grid">
                <div onclick="openFicheMobile()" class="action-card">
                    <div class="action-title">‚öñÔ∏è Dossier mobile juridique</div>
                    <div class="action-desc">Intervention itin√©rante (avec assistant)</div>
                </div>
                <a href="https://docs.google.com/spreadsheets/d/1HHgQbhCWtAS_LD93yFf9JncpuvCoXVod112bTr5wYmo/edit?usp=sharing" target="_blank" class="action-card">
                    <div class="action-title">üìû Annuaire juridique</div>
                    <div class="action-desc">Avocats, p√¥les, partenaires</div>
                </a>
                <a href="https://drive.google.com/file/d/1CiJANqE4y4xSXFPU842kEH-B6KxNVoL1/view" target="_blank" class="action-card">
                    <div class="action-title">‚öñÔ∏è Protocole mobile</div>
                    <div class="action-desc">Proc√©dure unit√© mobile</div>
                </a>
                <a href="https://drive.google.com/file/d/1FIsLRBXEMoAzB21MkjwstZ-WUueROhuD/view" target="_blank" class="action-card">
                    <div class="action-title">üó∫Ô∏è Guide mobiles</div>
                    <div class="action-desc">Gestion itin√©rante</div>
                </a>
                <a href="#" id="booking-mobile-link" target="_blank" class="action-card">
                    <div class="action-title">üìå R√©server un cr√©neau</div>
                    <div class="action-desc">Tourn√©e mobile</div>
                </a>
                <a href="https://wa.me/33784812030" target="_blank" class="action-card" style="border-color:#25D366;">
                    <div class="action-title">üì± CARELINE WhatsApp</div>
                    <div class="action-desc">Contacter l'√©quipe soutien</div>
                </a>
            </div>
        </div>

        <!-- Boutons de contr√¥le -->
        <div style="display:flex; gap:1rem; justify-content:space-between;">
            <button class="btn btn-outline" onclick="changerPermanence()">üîÑ Changer de permanence</button>
            <button class="btn-logout" onclick="confirmerDeconnexion()">Terminer la permanence</button>
        </div>
    </div>
</div>

<!-- ========== MODALES DES FORMULAIRES ========== -->

<!-- Fiche Contact (Classique) -->
<div id="modal-fiche-contact" class="modal-overlay hidden">[... Ici, ins√©rez la modale compl√®te de la fiche contact (avec sections conditionnelles et bien-√™tre) ...]</div>

<!-- Fiche Mobile Juridique -->
<div id="modal-fiche-mobile" class="modal-overlay hidden">[... Ici, ins√©rez la modale compl√®te de la fiche mobile juridique (avec assistant et bien-√™tre) ...]</div>

<!-- Fiche Juridique Approfondie (Classique) -->
<div id="modal-fiche-juridique" class="modal-overlay hidden">[... Ici, ins√©rez la modale compl√®te de la fiche juridique approfondie (tr√®s longue, avec assistant et bien-√™tre) ...]</div>

<!-- Modale Fin de Session -->
<div id="modal-logout" class="modal-overlay hidden">
    <div class="modal-container" style="max-width:480px; text-align:center; padding:2rem;">
        <h2 style="color:var(--lge-green); font-weight:800;">Session termin√©e</h2>
        <p id="logout-summary" style="margin:2rem 0;"></p>
        <button class="btn btn-primary" onclick="fermerTout()">Retour √† l'accueil</button>
    </div>
</div>

<script>
    // ========== CONFIGURATION ==========
    const APPS_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzLk1Wryy2yGnr5qp3FcaqnWX319DiLIh_wzXXky5SINwElHG31tDOQUXgHRMDP_4zz/exec";

    // ========== GESTION DE L'HORLOGE ==========
    function updateClock() {
        const now = new Date();
        document.getElementById('date-now').innerText = now.toLocaleDateString('fr-FR', { weekday:'short', day:'numeric', month:'short' });
        document.getElementById('time-now').innerText = now.toLocaleTimeString('fr-FR', { hour:'2-digit', minute:'2-digit' });
    }
    setInterval(updateClock, 1000);

    // ========== CONNEXION / SESSION ==========
    function demarrerPermanence(e) {
        e.preventDefault();
        const email = document.getElementById('email-input').value.trim();
        const type = document.getElementById('permanence-type').value;
        if (!email.includes('@')) { alert("Email valide requis"); return; }
        const now = new Date();
        localStorage.setItem('lge_email', email);
        localStorage.setItem('lge_start', now.toISOString());
        localStorage.setItem('lge_type', type);
        lancerInterface(email, now, type);
    }

    function lancerInterface(email, start, type) {
        document.getElementById('login-screen').classList.add('hidden');
        document.getElementById('dashboard').classList.remove('hidden');
        document.getElementById('user-display').innerText = email;
        document.getElementById('start-time-display').innerText = start.toLocaleTimeString('fr-FR', { hour:'2-digit', minute:'2-digit' });
        document.getElementById('permanence-type-display').innerText = type === 'classique' ? 'Classique' : 'Mobile Juridique';

        // Afficher le bon onglet par d√©faut
        if (type === 'classique') {
            switchTab('classique');
        } else {
            switchTab('mobile');
        }
    }

    // ========== NAVIGATION PAR ONGLETS ==========
    function switchTab(tabId) {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => c.classList.add('hidden'));
        document.querySelector(`.tab[data-tab="${tabId}"]`).classList.add('active');
        document.getElementById(`tab-${tabId}`).classList.remove('hidden');
    }

    // ========== CHANGER DE PERMANENCE SANS D√âCONNEXION ==========
    function changerPermanence() {
        // Retour √† l'√©cran de connexion sans effacer les donn√©es (pour pouvoir relancer)
        document.getElementById('dashboard').classList.add('hidden');
        document.getElementById('login-screen').classList.remove('hidden');
        // On peut pr√©-remplir l'email si souhait√©
        document.getElementById('email-input').value = localStorage.getItem('lge_email') || '';
    }

    // ========== FICHE CONTACT ==========
    // ... fonctions openFicheContact, closeFicheContact, resetFicheContact, categorieChange, submitFicheContact (√† copier depuis le code pr√©c√©dent) ...

    // ========== FICHE MOBILE JURIDIQUE ==========
    // ... fonctions openFicheMobile, closeFicheMobile, submitFicheMobile, analyserFicheMobile (√† copier depuis le code pr√©c√©dent) ...

    // ========== FICHE JURIDIQUE APPROFONDIE ==========
    function openFicheJuridique() {
        document.getElementById('form-fiche-juridique').reset();
        // R√©initialiser tous les checkbox
        document.querySelectorAll('#form-fiche-juridique input[type="checkbox"]').forEach(cb => cb.checked = false);
        // R√©initialiser bien-√™tre
        document.getElementById('bienetre-juridique').value = '';
        document.getElementById('bienetre-juridique-details').value = '';
        document.getElementById('bienetre-reco-juridique').innerHTML = '';
        document.querySelectorAll('#bienetre-emojis-juridique .emoji-option').forEach(el => el.classList.remove('selected'));
        document.getElementById('rapport-juridique').innerHTML = '';
        document.getElementById('modal-fiche-juridique').classList.remove('hidden');
    }
    function closeFicheJuridique() {
        document.getElementById('modal-fiche-juridique').classList.add('hidden');
    }
    function analyserFicheJuridique() {
        const donnees = {
            theme: "Juridique",
            objet: document.getElementById('juridique-resume-auto')?.value || '',
            situation_admin: document.getElementById('juridique-nationalite')?.value || ''
        };
        const rapport = analyserSituationJuridique(donnees);
        afficherRapport(rapport, 'rapport-juridique');
    }
    async function submitFicheJuridique(e) {
        e.preventDefault();
        // Construire l'objet payload avec tous les champs (tr√®s long, √† impl√©menter)
        // Pour gagner de la place, je ne r√©√©cris pas ici les 90+ champs, mais vous devez les r√©cup√©rer comme dans le message pr√©c√©dent.
        // Exemple :
        const payload = {
            type_permanence: 'juridique',
            nom: document.getElementById('juridique-nom')?.value || '',
            prenom: document.getElementById('juridique-prenom')?.value || '',
            // ... tous les autres champs
            bienetre: document.getElementById('bienetre-juridique')?.value || '',
            bienetre_details: document.getElementById('bienetre-juridique-details')?.value || '',
            benevole_session: localStorage.getItem('lge_email'),
            start_session: localStorage.getItem('lge_start')
        };
        try {
            const response = await fetch(APPS_SCRIPT_URL, { method:'POST', body:JSON.stringify(payload) });
            const result = await response.text();
            alert('Fiche juridique enregistr√©e !');
            closeFicheJuridique();
        } catch(err) { alert('Erreur : '+err.message); }
    }

    // ========== BIEN-√äTRE (fonction commune) ==========
    function selectionnerEmotion(formType, value) {
        document.getElementById(`bienetre-${formType}`).value = value;
        const row = document.getElementById(`bienetre-emojis-${formType}`);
        row.querySelectorAll('.emoji-option').forEach(el => el.classList.remove('selected'));
        event.currentTarget.classList.add('selected');
        genererRecommandationsBienetre(formType, value);
    }
    function genererRecommandationsBienetre(formType, niveau) {
        const recoDiv = document.getElementById(`bienetre-reco-${formType}`);
        let message = '';
        switch(niveau) {
            case 'tres-bien': case 'bien':
                message = `<p><strong>üëç C'est une bonne nouvelle !</strong> Activit√©s propos√©es : atelier bien-√™tre, sortie conviviale, activit√©s cr√©atives.</p>`;
                break;
            case 'neutre':
                message = `<p><strong>üßò Un petit boost ?</strong> Atelier mieux-√™tre, groupe de parole, yoga.</p>`;
                break;
            case 'mal': case 'tres-mal':
                message = `<p><strong>üÜò Des ressources disponibles :</strong> CARELINE (07 84 81 20 30), permanence psychologique, 3114, 3919.</p>`;
                break;
            default: message = '<p>S√©lectionnez une √©motion.</p>';
        }
        recoDiv.innerHTML = message;
    }

    // ========== ASSISTANT JURIDIQUE ==========
    const baseConnaissances = { /* ... copier depuis le code pr√©c√©dent ... */ };
    function analyserSituationJuridique(donnees) {
        // ... copier la fonction existante ...
    }
    function afficherRapport(rapport, elementId) {
        // ... copier la fonction existante ...
    }

    // ========== FIN DE SESSION ==========
    function confirmerDeconnexion() {
        const start = new Date(localStorage.getItem('lge_start'));
        const end = new Date();
        const diff = Math.floor((end-start)/1000);
        const heures = Math.floor(diff/3600);
        const minutes = Math.floor((diff%3600)/60);
        document.getElementById('logout-summary').innerText = `B√©n√©vole : ${localStorage.getItem('lge_email')}\nDur√©e : ${heures}h ${minutes}min`;
        document.getElementById('modal-logout').classList.remove('hidden');
        fetch(APPS_SCRIPT_URL, {
            method:'POST',
            body:JSON.stringify({ type:'fin_session', email:localStorage.getItem('lge_email'), start:start.toISOString(), end:end.toISOString(), duree:`${heures}h${minutes}` })
        }).catch(()=>{});
    }
    function fermerTout() { localStorage.clear(); location.reload(); }

    // ========== INIT ==========
    window.onload = function() {
        updateClock();
        const email = localStorage.getItem('lge_email');
        if (email) {
            const start = new Date(localStorage.getItem('lge_start'));
            const type = localStorage.getItem('lge_type');
            lancerInterface(email, start, type);
        }
    };
</script>
</body>
</html>
